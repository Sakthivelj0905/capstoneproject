<header>
  <app-navbar></app-navbar>
</header>

<main class="container my-4">

  <section class="package-info mt-4 animate__animated animate__fadeInUp">
    <h2 class="package-title">{{ package.name }}</h2>
    <p class="package-overview">{{ package.overview }}</p>
    
  <!-- Itinerary images -->
  <div class="row mt-3">
    <div class="col-6 col-md-3 mb-3" *ngFor="let img of package.images">
      <img [src]="img" class="booking-img" alt="Itinerary">
    </div>
  </div>

  <!-- Package Info Section -->

    <div class="info-grid">
      <p><strong>Package ID:</strong> {{ package.id }}</p>
      <p><strong>Duration:</strong> {{ package.duration }} Days</p>
      <p><strong>Slots Available:</strong> {{ package.slots }}</p>
      <p *ngIf="package.slots < 5" class="text-danger small mt-n2">
            âš¡ Few slots left, hurry up!
          </p>
    </div>

    <!-- Itinerary -->
    <h5 class="mt-3">Itinerary</h5>
<div class="itinerary-container">
  <div *ngFor="let day of package.itinerary; let i = index" class="itinerary-item">
    <div class="day-circle">{{ i + 1 }}</div>
    <div class="itinerary-content">
      <h6>{{ day.plan }}</h6>
      <p>{{ day.duration }}</p>
    </div>
  </div>
</div>


    <!-- Description -->
    <h5 class="mt-3">About the Trip</h5>
    <p>{{ package.description }}</p>

    <!-- Insights -->
    <div class="insight-box animate__animated animate__pulse">
      ðŸ’¡ <em>{{ package.insights }}</em>
    </div>

    <!-- Suggestions -->
    <h5 class="mt-3">Best For</h5>
    <div class="suggestion-tags">
      <span *ngFor="let s of package.suggestions" class="tag">{{ s }}</span>
    </div>

    <!-- Instructions -->
    <h5 class="mt-3">Travel Instructions</h5>
    <ul>
      <li *ngFor="let instr of instructionList">{{ instr }}</li>
    </ul>

  </section>

  <!-- Facilities icons -->
<section class="mt-4 facilities-vehicles">
  <!-- Facilities -->
  <div class="facilities">
    <h4>Facilities Provided</h4>
    <div class="facility-icons">
      <div *ngFor="let facility of package.facilities" class="facility-item">
      <img  [src]="facility.icon" [alt]="facility.name" class="facility-icon">
      <p class="mt-1">{{ facility.name }}</p>
    </div>
  </div>
  </div>

  <!-- Vehicles -->
  <div class="vehicles">
    <h4>Available Vehicles</h4>
    <div class="vehicle-icons">
      <div *ngFor="let vehicle of package.vehicles" class="vehicle-item">
        <img [src]="vehicle.icon" [alt]="vehicle.name" class="vehicle-icon">
        <p>{{ vehicle.name }}</p>
      </div>
    </div>
  </div>
</section>


  <!-- I'm Impressed button -->
  <div class="text-center my-4 animate__animated animate__bounceIn">
    <button class="impressed-btn" (click)="showBookingForm = true" *ngIf="!showBookingForm">
      I'm Intersted <i class="fa-solid fa-rocket"></i>
    </button>
  </div>

<section class="booking-section mt-4" *ngIf="showBookingForm">
  <h5 class="form-title">Booking Form</h5>
  <form #bookingNgForm="ngForm" (ngSubmit)="bookNow(bookingNgForm)" class="booking-form" novalidate>

    <!-- Package Name & ID (readonly) -->
    <div class="input-group">
      <input type="text" [value]="package.name" readonly placeholder=" " required />
      <label>Package Name</label>
    </div>

    <div class="input-group">
      <input type="text" [value]="package.id" readonly placeholder=" " required />
      <label>Package ID</label>
    </div>

    <!-- Travelers -->
    <div *ngFor="let person of bookingForm.persons; let i = index" class="person-card">
      <h6>Traveler {{ i + 1 }}</h6>

      <div class="input-group">
        <input type="text" [(ngModel)]="person.name" name="name{{i}}" required minlength="2" placeholder=" " #nameRef="ngModel" />
        <label>Name</label>
        <div class="text-danger small" *ngIf="nameRef.invalid && nameRef.touched">
          Name is required (min 2 characters).
        </div>
      </div>

      <div class="input-group">
        <input type="number" [(ngModel)]="person.mobile" name="mobile{{i}}" required pattern="^[0-9]{10}$" placeholder=" " #mobileRef="ngModel"/>
        <label>Mobile</label>
        <div class="text-danger small" *ngIf="mobileRef.invalid && mobileRef.touched">
          Enter a valid 10-digit mobile number.
        </div>
      </div>

        <div class="input-group">
        <input type="email" [(ngModel)]="person.email" name="email{{i}}" required email placeholder=" " #emailRef="ngModel"/>
        <label>Email</label>

        <!-- Error Messages -->
        <div class="text-danger small" *ngIf="emailRef.touched && emailRef.invalid">
        <div *ngIf="emailRef.errors?.['required']">
        Email is required.
        </div>
        <div *ngIf="emailRef.errors?.['email']">
          Please enter a valid email.
        </div>
        </div>
        </div>


      <div class="input-group">
        <input type="text" [(ngModel)]="person.residence" name="residence{{i}}" required placeholder=" " #residenceRef="ngModel"/>
        <label>Place of Residence</label>
        <div class="text-danger small" *ngIf="residenceRef.invalid && residenceRef.touched">
          Residence is required.
        </div>
      </div>

      <div class="input-group">
        <input type="number" [(ngModel)]="person.age" name="age{{i}}" required min="1" max="120" placeholder=" " #ageRef="ngModel"/>
        <label>Age</label>
        <div class="text-danger small" *ngIf="ageRef.invalid && ageRef.touched">
          Age is required (1-120).
        </div>
      </div>

      <div class="input-group">
        <select [(ngModel)]="person.gender" name="gender{{i}}" required #genderRef="ngModel">
          <option value="" disabled>Select Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Other</option>
        </select>
        <div class="text-danger small" *ngIf="genderRef.invalid && genderRef.touched">
          Gender is required.
        </div>
      </div>

      <button type="button" class="remove-btn" (click)="removePerson(i)" *ngIf="bookingForm.persons.length > 1">
        <i class="fa-solid fa-xmark"></i> Remove Traveler
      </button>
    </div>

    <button type="button" class="add-btn" (click)="addPerson()">
      <i class="fa-solid fa-plus"></i> Add Traveler
    </button>

    <!-- Vehicle -->
    <div class="input-group mt-3">
      <select [(ngModel)]="bookingForm.vehicle" name="vehicle" required #vehicleRef="ngModel">
        <option value="" disabled hidden>Select Vehicle</option>
        <option *ngFor="let v of package.vehicles" [value]="v.name">{{ v.name }}</option>
      </select>
      <label>Select Vehicle</label>
      <div class="text-danger small" *ngIf="vehicleRef.invalid && vehicleRef.touched">
        Vehicle selection is required.
      </div>
    </div>

    <!-- Batch -->
    <div class="input-group mt-3">
      <select [(ngModel)]="bookingForm.batch" name="batch" required #batchRef="ngModel">
        <option value="" disabled hidden>Select Batch</option>
        <option *ngFor="let b of package.batches" [value]="b">{{ b }}</option>
      </select>
      <label>Select Batch</label>
      <div class="text-danger small" *ngIf="batchRef.invalid && batchRef.touched">
        Batch selection is required.
      </div>
    </div>

    <!-- Submit -->
    <button type="submit" class="glow-btn mt-3" [disabled]="bookingNgForm.invalid">Book Now</button>

  </form>
  </section>
</main>

<footer>
  <app-footer></app-footer>
</footer>

<app-popup [visible]="popupOpen" title="Booking Status" (closed)="closePopup()">
  <ng-container *ngIf="popupType === 'success'; else errorTemplate">
    <p><i class="fa-solid fa-check"></i> {{ popupMessage }}</p>
  </ng-container>

  <ng-template #errorTemplate>
    <p><i class="fa-solid fa-xmark"></i> {{ popupMessage }}</p>
  </ng-template>
</app-popup>